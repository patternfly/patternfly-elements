<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <script src="/components/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
    <script src="/components/web-component-tester/browser.js"></script>
        <script>
        // delete window.fetch;
        </script>
    <script type="module" src="../cp-more-like-this.js"></script>
  </head>
  <body>
    <script>
      suite('<cp-more-like-this', () => {
        let timesCalled = 0;
        const elementId = 'cpMoreLikeThis';
        const dataResponse = {"spellcheck":{"suggestions":["access",{"numFound":3,"startOffset":18,"endOffset":24,"suggestion":["accessed","accessing","accessible"]},"redhat",{"numFound":1,"startOffset":25,"endOffset":31,"suggestion":["redhat.com"]},"com",{"numFound":1,"startOffset":32,"endOffset":35,"suggestion":["common"]}],"collations":["collation","{!mlt}https://api.access.redhat.com.command/rs/solutions/1336663","collation","{!mlt}https://api.access.redhat.com.completed/rs/solutions/1336663","collation","{!mlt}https://api.access.redhat.com.redhat.command/rs/solutions/1336663","collation","{!mlt}https://api.access.redhat.com.redhat.common/rs/solutions/1336663","collation","{!mlt}https://api.access.redhat.command/rs/solutions/1336663"]},"response":{"numFound":49094,"start":0,"maxScore":91.17944,"docs":[{"documentKind":"Solution","uri":"https://api.access.redhat.com/rs/solutions/2572201","path":"https://api.access.redhat.com/rs/solutions/2572201","view_uri":"https://access.redhat.com/solutions/2572201","title":"[Satellite6] Unable to deploy puppet module in Satellite server, puppet class is not listed in Sat WEBUI > Configure > Puppet Classes","allTitle":"[Satellite6] Unable to deploy puppet module in Satellite server, puppet class is not listed in Sat WEBUI > Configure > Puppet Classes","sortTitle":"[Satellite6] Unable to deploy puppet module in Satellite server, puppet class is not listed in Sat WEBUI > Configure > Puppet Classes","id":"2572201","solution.id":"2572201","authorSSOName":"rhn-support-jalviso","lastModifiedBySSOName":"rhn-support-jalviso","hasPublishedRevision":"true","body":["* Red Hat Satellite 6","* Verify that the puppet module files/folder has owner:group permission of root:root and mode to 755. Example puppet module with correct permission: ~~~ # cd server-jboss-0.1.0/ [root@admin-satellite6 server-jboss-0.1.0]# ls-l-rwxr-xr-x. 1 root root 614 May 20 14:21 checksums.json drwxr-xr-x. 2 root root 20 May 19 09:10 examples-rwxr-xr-x. 1 root root 242 May 18 13:44 Gemfile drwxr-xr-x. 2 root root 20 May 19 09:17 manifests-rwxr-xr-x. 1 root root 520 May 20 14:21 metadata.json drwxr-xr-x. 3 root root 75 Jun 30 05:16 pkg-rwxr-xr-x. 1 root root 633 May 18 13:44 Rakefile-rwxr-xr-x. 1 root root 2883 May 18 13:44 README.md drwxr-xr-x. 2 root root 64 May 20 14:09 READY_FOR_UPLOAD drwxr-xr-x. 3 root root 41 May 18 13:44 spec [root@admin-satellite6 server-jboss-0.1.0]# cd manifests/ [root@jalviso-sat6rhel7sp manifests]# ls-l-rwxr-xr-x. 1 root root 1058 May 19 09:13 init.pp ~~~ * If permission/mode is incorrect, change the permission from the puppet module itself; e.g. unpacking the puppet module, change mode/permission and again pack/tar. * Go to Content > Product and upload the puppet module. * Publish/Promote the Content View and the puppet class will be available to add in Configure > Puppet Classes","* The created puppet module has wrong mode/owner/group permission.","- Deployed puppet module by:- Create Custom Product then add puppet repo and upload the puppet module.- Add the puppet module to the Content View then publish Promote- Go to Configure > Puppet Classes but puppet class is not listed.- Change the permission on the module in /etc/puppet/environment/KT_CVNAME. But after publish/promote of the Content View, permission of /etc/puppet/environment/KT_CVNAME changes back to the original.","SysMgmt","Red Hat Satellite"],"issue":["Unable to deploy puppet module in Satellite server. Puppet class is not listed in Sat WEBUI > Configure > Puppet Classes"],"issueTag":["* Unable to deploy puppet module in Satellite server. Puppet class is not listed in Sat WEBUI > Configure > Puppet Classes"],"lastModifiedDate":"2016-08-25T07:32:34Z","createdDate":"2016-08-25T07:25:32Z","kcsState":"unverified","ModerationState":"published","accessState":"active","setLanguage":"en","abstract":"* Unable to deploy puppet module in Satellite server. Puppet class is not listed in Sat WEBUI   Configure   Puppet Classes * The created puppet module has wrong mode/owner/group permission. * Verify that the puppet module files/folder has owner:group permission of root:root and mode to 755. Example puppet module with correct permission: ~~~ # cd server-jboss-0.1.0/ [root@admin-satellite6 server-jboss-0.1.0]# ls-l-rwxr-xr-x. 1 root root 614 May 20 14:21 checksums.json drwxr-xr-x. 2 root root 20 May 19 09:10 examples-rwxr-xr-x. 1 root root 242 May 18 13:44 Gemfile drwxr-xr-x. 2 root root 20 May 19 09:17 manifests-rwxr-xr-x. 1 root root 520 May 20 14:21 metadata.json drwxr-xr-x. 3 root root 75 Jun 30 05:16 pkg-rwxr-xr-x. 1 root root 633 May 18 13:44 Rakefile-rwxr-xr-x. 1 root root 2883 May 18 13:44 README.md drwxr-xr-x. 2 root root 64 May 20 14:09 READY_FOR_UPLOAD drwxr-xr-x. 3 root root 41 May 18 13:44 spec [root@admin-satellite6 server-jboss-0.1.0]# cd manifests/ [root@jalviso-sat6rhel7sp manifests]# ls-l-rwxr-xr-x. 1 root root 1058 May 19 09:13 init.pp ~~~ * If permission/mode is incorrect, change the permission from the puppet module itself; e.g. unpacking the puppet module, change mode/permission and again pack/tar. * Go to Content   Product and upload the puppet module. * Publish/Promote the Content View and the puppet class will be available to add in Configure   Puppet Classes [Satellite6] Unable to deploy puppet module in Satellite server, puppet class is not listed in Sat WEBUI   Configure   Puppet Classes","detectedLanguage":["en"],"language":"en","sbr":["SysMgmt"],"product":["Red Hat Satellite"],"publishedTitle":"[Satellite6] Unable to deploy puppet module in Satellite server, puppet class is not listed in Sat WEBUI > Configure > Puppet Classes","publishedAbstract":"* Unable to deploy puppet module in Satellite server. Puppet class is not listed in Sat WEBUI &gt; Configure &gt; Puppet Classes","caseCount":3,"caseCount_365":0,"category":["Troubleshoot"],"publication_state":"unverified","requires_subscription":true,"boostProduct":"satellite","boostVersion":"6","detectedProducts":["satellite"],"duplicateResourceId":"","extracted_entities":["url|https://api.access.redhat.com/rs/solutions/2572201","url|https://api.access.redhat.com/rs/solutions/2572201","url|https://access.redhat.com/solutions/2572201","word|e.g.","file|/folder","file|folder","file|/mode","file|mode","file|/permission","file|permission","file|/tar.","file|tar.","file|/Promote","file|Promote","file|server-jboss.0","file|server-jboss.0","file|checksums.json","file|metadata.json","file|README.md","file|server-jboss.0","file|init.pp","file|/owner/group","file|group","file|/etc/puppet/environment/KT_CVNAME.","file|KT_CVNAME.","file|/promote","file|promote","file|/etc/puppet/environment/KT_CVNAME","file|KT_CVNAME","file|module.-","file|listed.-","file|/etc/puppet/environment/KT_CVNAME.","file|KT_CVNAME.","file|/promote","file|promote","file|/etc/puppet/environment/KT_CVNAME","file|KT_CVNAME","file|module.-","file|listed.-","file|/etc/puppet/environment/KT_CVNAME.","file|KT_CVNAME.","file|/promote","file|promote","file|/etc/puppet/environment/KT_CVNAME","file|KT_CVNAME","file|module.-","file|listed.-","word|e.g.","file|/owner/group","file|group","file|/folder","file|folder","file|/mode","file|mode","file|/permission","file|permission","file|/tar.","file|tar.","file|/Promote","file|Promote","file|server-jboss.0","file|server-jboss.0","file|checksums.json","file|metadata.json","file|README.md","file|server-jboss.0","file|init.pp"],"timestamp":"2018-06-15T17:28:29.053Z","component":["puppet"],"resolution_string":"* Verify that the puppet module files/folder has owner:group permission of root:root and mode to 755. Example puppet module with correct permission: ~~~ # cd server-jboss-0.1.0/ [root@admin-satellite6 server-jboss-0.1.0]# ls-l-rwxr-xr-x. 1 root root 614 May 20 14:21 checksums.json drwxr-xr-x. 2 root root 20 May 19 09:10 examples-rwxr-xr-x. 1 root root 242 May 18 13:44 Gemfile drwxr-xr-x. 2 root root 20 May 19 09:17 manifests-rwxr-xr-x. 1 root root 520 May 20 14:21 metadata.json drwxr-xr-x. 3 root root 75 Jun 30 05:16 pkg-rwxr-xr-x. 1 root root 633 May 18 13:44 Rakefile-rwxr-xr-x. 1 root root 2883 May 18 13:44 README.md drwxr-xr-x. 2 root root 64 May 20 14:09 READY_FOR_UPLOAD drwxr-xr-x. 3 root root 41 May 18 13:44 spec [root@admin-satellite6 server-jboss-0.1.0]# cd manifests/ [root@jalviso-sat6rhel7sp manifests]# ls-l-rwxr-xr-x. 1 root root 1058 May 19 09:13 init.pp ~~~ * If permission/mode is incorrect, change the permission from the puppet module itself; e.g. unpacking the puppet module, change mode/permission and again pack/tar. * Go to Content > Product and upload the puppet module. * Publish/Promote the Content View and the puppet class will be available to add in Configure > Puppet Classes","_version_":1603360479334367232,"title_string":"[Satellite6] Unable to deploy puppet module in Satellite server, puppet class is not listed in Sat WEBUI > Configure > Puppet Classes","issue_string":"* Unable to deploy puppet module in Satellite server. Puppet class is not listed in Sat WEBUI > Configure > Puppet Classes"},{"documentKind":"Solution","uri":"https://api.access.redhat.com/rs/solutions/1270033","path":"https://api.access.redhat.com/rs/solutions/1270033","view_uri":"https://access.redhat.com/solutions/1270033","title":"How to deploy market place for Openshift Enterprise.","allTitle":"How to deploy market place for Openshift Enterprise.","sortTitle":"How to deploy market place for Openshift Enterprise.","id":"1270033","solution.id":"1270033","authorSSOName":"rhn-support-misalunk","lastModifiedBySSOName":"rhn-support-jkaur","hasPublishedRevision":"true","body":["- Openshift Enterprise 2.1","- For now the Openshift Enterprise doesn't support the functionality of having an market place.","Cloud Prods &amp; Envs","openshift","Red Hat OpenShift Container Platform"],"issue":["- Support for market place in Openshift Enterprise.- How to deploy market place for Openshift Enterprise."],"issueTag":["- Support for market place in Openshift Enterprise.- How to deploy market place for Openshift Enterprise.","openshift"],"lastModifiedDate":"2014-12-05T12:11:07Z","createdDate":"2014-11-15T07:47:46Z","kcsState":"verified","ModerationState":"published","accessState":"active","setLanguage":"en","abstract":"- Support for market place in Openshift Enterprise.- How to deploy market place for Openshift Enterprise.  - For now the Openshift Enterprise doesn't support the functionality of having an market place. How to deploy market place for Openshift Enterprise.","detectedLanguage":["en"],"language":"en","sbr":["Cloud Prods &amp; Envs"],"tag":["openshift"],"product":["Red Hat OpenShift Container Platform"],"publishedTitle":"How to deploy market place for Openshift Enterprise.","publishedAbstract":"- Support for market place in Openshift Enterprise.- How to deploy market place for Openshift Enterprise. ","caseCount":1,"caseCount_365":0,"category":["Supportability"],"publication_state":"verified","requires_subscription":true,"boostProduct":"openshift","boostVersion":"2","detectedProducts":["openshift"],"duplicateResourceId":"","extracted_entities":["url|https://api.access.redhat.com/rs/solutions/1270033","url|https://api.access.redhat.com/rs/solutions/1270033","url|https://access.redhat.com/solutions/1270033","file|Enterprise.-","file|Enterprise.-","file|Enterprise.-","file|Enterprise.-","file|Enterprise.-","file|Enterprise.-"],"timestamp":"2018-06-15T16:58:02.632Z","resolution_string":"- For now the Openshift Enterprise doesn't support the functionality of having an market place.","_version_":1603358564148051968,"title_string":"How to deploy market place for Openshift Enterprise.","issue_string":"- Support for market place in Openshift Enterprise.- How to deploy market place for Openshift Enterprise."},{"documentKind":"Solution","uri":"https://api.access.redhat.com/rs/solutions/2595271","path":"https://api.access.redhat.com/rs/solutions/2595271","view_uri":"https://access.redhat.com/solutions/2595271","title":"OpenShift deployment is not available and cannot be selected when deploying OpenStack","allTitle":"OpenShift deployment is not available and cannot be selected when deploying OpenStack","sortTitle":"OpenShift deployment is not available and cannot be selected when deploying OpenStack","id":"2595271","solution.id":"2595271","authorSSOName":"rhn-support-jsaucier","lastModifiedBySSOName":"rhn-support-jsaucier","hasPublishedRevision":"true","body":["- Quickstart Cloud Installer 1","OpenShift can only be deployed at the same time and in the same deployment as Red Hat Virtualization (RHV- Traditional Workloads) using the Quickstart Cloud Installer. It is not currently supported by QCI to deploy OpenShift on Red Hat OpenStack Platform. When only RH-OSP is selected in a new deployment, the OpenShift option remains greyed: The alternatives are:- Choose to deploy OpenShift with RHV in a new deployment.- It is still possible to manually deploy OpenShift using the [OpenShift product documentation.](https://access.redhat.com/documentation/en/openshift-enterprise/version-3.2/installation-and-configuration/#installing)","Stack","cloud","openshift","openstack","rhev","Red Hat Cloud Infrastructure","Red Hat Cloud Suite","Red Hat OpenStack Platform","Red Hat OpenShift Container Platform"],"issue":["- Cannot deploy OpenShift using the Quickstart Cloud Installer.- OpenShift deployment is greyed and cannot be selected.- OpenShift can only be deployed when selecting Red Hat Virtualization"],"issueTag":["- Cannot deploy OpenShift using the Quickstart Cloud Installer.- OpenShift deployment is greyed and cannot be selected.- OpenShift can only be deployed when selecting Red Hat Virtualization","cloud","openshift","openstack","rhev"],"lastModifiedDate":"2016-09-02T11:57:46Z","createdDate":"2016-08-31T22:38:03Z","kcsState":"wip","ModerationState":"published","accessState":"active","setLanguage":"en","abstract":"- Cannot deploy OpenShift using the Quickstart Cloud Installer.- OpenShift deployment is greyed and cannot be selected.- OpenShift can only be deployed when selecting Red Hat Virtualization OpenShift can only be deployed at the same time and in the same deployment as Red Hat Virtualization (RHV- Traditional Workloads) using the Quickstart Cloud Installer. It is not currently supported by QCI to deploy OpenShift on Red Hat OpenStack Platform. When only RH-OSP is selected in a new deployment, the OpenShift option remains greyed: The alternatives are:- Choose to deploy OpenShift with RHV in a new deployment.- It is still possible to manually deploy OpenShift using the [OpenShift product documentation.](https://access.redhat.com/documentation/en/openshift-enterprise/version-3.2/installation-and-configuration/#installing) OpenShift deployment is not available and cannot be selected when deploying OpenStack","detectedLanguage":["en"],"language":"en","sbr":["Stack"],"tag":["cloud","openshift","openstack","rhev"],"product":["Red Hat Cloud Infrastructure","Red Hat Cloud Suite","Red Hat OpenStack Platform","Red Hat OpenShift Container Platform"],"publishedTitle":"OpenShift deployment is not available and cannot be selected when deploying OpenStack","publishedAbstract":"- Cannot deploy OpenShift using the Quickstart Cloud Installer.- OpenShift deployment is greyed and cannot be selected.- OpenShift can only be deployed when selecting Red Hat Virtualization","caseCount":0,"caseCount_365":0,"category":["Supportability"],"publication_state":"wip","requires_subscription":true,"boostProduct":"quickstartcloudinstaller","boostVersion":"1","detectedProducts":["quickstartcloudinstaller","openshift","openstack","cloudinfrastructure"],"duplicateResourceId":"","extracted_entities":["url|https://api.access.redhat.com/rs/solutions/2595271","url|https://api.access.redhat.com/rs/solutions/2595271","url|https://access.redhat.com/solutions/2595271","file|Installer.-","file|selected.-","file|Installer.-","file|selected.-","file|Installer.-","file|selected.-","file|Installer.-","file|selected.-","url|https://access.redhat.com/documentation/en/openshift-enterprise/version-3.2/installation-and-configuration","file|deployment.-","url|https://access.redhat.com/documentation/en/openshift-enterprise/version-3.2/installation-and-configuration","file|Installer.-","file|selected.-","file|deployment.-","file|Installer.-","file|selected.-"],"timestamp":"2018-06-15T17:18:53.262Z","component":["installer"],"resolution_string":"OpenShift can only be deployed at the same time and in the same deployment as Red Hat Virtualization (RHV- Traditional Workloads) using the Quickstart Cloud Installer. It is not currently supported by QCI to deploy OpenShift on Red Hat OpenStack Platform. When only RH-OSP is selected in a new deployment, the OpenShift option remains greyed: The alternatives are:- Choose to deploy OpenShift with RHV in a new deployment.- It is still possible to manually deploy OpenShift using the [OpenShift product documentation.](https://access.redhat.com/documentation/en/openshift-enterprise/version-3.2/installation-and-configuration/#installing)","_version_":1603359875689086976,"title_string":"OpenShift deployment is not available and cannot be selected when deploying OpenStack","issue_string":"- Cannot deploy OpenShift using the Quickstart Cloud Installer.- OpenShift deployment is greyed and cannot be selected.- OpenShift can only be deployed when selecting Red Hat Virtualization"}]},"responseHeader":{"zkConnected":true,"status":0,"QTime":208,"params":{"q":"{!mlt}https://api.access.redhat.com/rs/solutions/1336663","mltDocSearch":"true","lw.pipelineId":"access-default","isFusionQuery":"true","enableSignals":"false","fq":[" -documentKind:( Case )"," -documentKind:( Symptom OR CalaverasAttributeDocumentKind OR Delete OR Link OR Unlink )","-accessState:(private OR retired) AND -hasPublishedRevision:false","-doNotDisplay:true","-documentKind:ImageRepository"],"rows":"3","wt":"json","version":"2.2","facet":"true","reqId":"\"c4016b52-de51-49a9-a11d-7cb2d3769e5c\""}},"facet_counts":{"facet_queries":{},"facet_fields":{},"facet_ranges":{},"facet_intervals":{},"facet_heatmaps":{}}};

        setup(() => {
          timesCalled += 1;

          sinon.stub(window, 'fetch');

          const res = new window.Response(JSON.stringify(dataResponse), {
            status: 200,
            headers: {
              'Content-type': 'application/json'
            }
          });

          if (timesCalled < 4) {
            window.fetch.returns(Promise.resolve(res));
          } else {
            window.fetch.returns(Promise.reject());
          }

          const element = document.createElement('cp-more-like-this');
          element.setAttribute('id', elementId);
          element.setAttribute('api-url', 'https://api.access.redhat.com/rs/search?q=id:1336663&mltDocSearch=true&rows=3');
          element.setAttribute('content-type', 'Solution');

          document.body.appendChild(element);
        });

        teardown(() => {
          const element = document.body.querySelector(`#${elementId}`);
          document.body.removeChild(element);

          window.fetch.restore();
        });

        test('it should display the content type', done => {
          const cpMoreLikeThis = document.querySelector(`#${elementId}`);

          flush(() => {
            const heading = cpMoreLikeThis.shadowRoot.querySelector('h3').textContent;

            assert.equal(cpMoreLikeThis['content-type'], 'Solution', '[content-type] attribute should equal "Solution"');
            assert.equal(heading, 'People who viewed this Solution also viewed', 'Heading should have "Solution" in it');
            done();
          });
        });

        test('it should display three solutions', done => {
          const cpMoreLikeThis = document.querySelector(`#${elementId}`);

          flush(() => {
            const cards = cpMoreLikeThis.shadowRoot.querySelectorAll('rh-card');
            assert.equal(cards.length, 3, 'It should show 3 cards');
            done();
          });
        });

        test('it should show the details of a solution', done => {
          const cpMoreLikeThis = document.querySelector(`#${elementId}`);

          flush(() => {
            const doc = dataResponse.response.docs[0];
            const card = cpMoreLikeThis.shadowRoot.querySelector('rh-card');
            const headerLink = card.querySelector('h4 a');
            const body = card.querySelector('span');
            const dateTime = body.querySelector('rh-datetime').shadowRoot.querySelector('span').textContent;

            assert.equal(doc.title, headerLink.textContent);
            assert.equal(doc.view_uri, headerLink.getAttribute('href'));
            assert.equal(doc.documentKind, body.textContent.split('-')[0].trim());
            assert.equal(doc.lastModifiedDate, body.textContent.replace(/\n/g, ' ').split(/-(.+)/)[1].trim());
            done();
          });
        });

        test('it should fire a cp-more-like-this:no-data event if no data is returned', done => {
          const spy = sinon.spy(console, 'warn');
          const handlerSpy = sinon.spy();

          document.addEventListener('cp-more-like-this:no-data', handlerSpy);

          flush(() => {
            sinon.assert.calledWith(spy, 'Error in retrieving data');
            sinon.assert.calledOnce(handlerSpy);

            document.removeEventListener('cp-more-like-this:no-data', handlerSpy);
            done();
          });
        });
      });
    </script>
  </body>
</html>
