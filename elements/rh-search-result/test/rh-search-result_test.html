<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <script src="/components/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
    <script src="/components/web-component-tester/browser.js"></script>
    <script type="module" src="../rh-search-result.js"></script>
  </head>
  <body>
    <rh-search-result>
      <h3 slot="heading">
        <a href="https://access.redhat.com/products/red-hat-enterprise-linux">Red Hat Enterprise Linux</a>
      </h3>
      <div slot="meta">
        <span class="recommended">Recommended:</span> Product Hub
      </div>
      The Red Hat Enterprise Linux product page on the Customer Portal has the latest downloads, curated knowledge, support information and implementation guides.
    </rh-search-result>

    <script>
      suite('<rh-search-result>', () => {
        test('it should upgrade', () => {
          assert.instanceOf(
            document.querySelector('rh-search-result'),
            customElements.get('rh-search-result'),
            'the <rh-search-result> should be an instance of RhSearchResult'
          );
        });
        test('it should show a search result', () => {
          const rhSearchResult = document.querySelector('rh-search-result');
          const shadowRoot = rhSearchResult.shadowRoot;
          const article = shadowRoot.querySelector('article');
          const heading = article.querySelector('#heading').textContent.trim();
          const meta = article.querySelector('slot[name="meta"]').assignedNodes()[0].textContent.trim();
          const body = article.querySelector('slot:nth-of-type(2)').assignedNodes()[2].textContent.trim();

          assert.isNotNull(article, 'it should be wrapped in an article');
          assert.equal(heading, 'Red Hat Enterprise Linux', 'it should show the correct heading');
          assert.equal(meta, 'Recommended: Product Hub');
          assert.equal(body, 'The Red Hat Enterprise Linux product page on the Customer Portal has the latest downloads, curated knowledge, support information and implementation guides.', 'it should show the correct body');
        });

        test('it should move the heading slot in the light dom to the header tag in the shadow dom', () => {
          const rhSearchResult = document.querySelector('rh-search-result');
          const originalHeading = rhSearchResult.querySelector('[slot="heading"]');
          const originalHeadingText = originalHeading.textContent.trim();
          const shadowRoot = rhSearchResult.shadowRoot;
          const article = shadowRoot.querySelector('article');
          const heading = article.querySelector('#heading');
          const headingText = heading.textContent.trim();

          assert.equal(originalHeading.tagName, heading.querySelector(`${originalHeading.tagName}`).tagName);
          assert.equal(originalHeadingText, headingText);
        });
      });
    </script>
  </body>
</html>
